/*!
 * Terminal Window widget
 * Copyright (c) 2016 Israel Roldan
 * Licensed under the MIT license
 */
var TerminalWindow=function(a){a=a||{},this.speed=a.speed||80,this.delimiter=a.delimiter||"$ ",this.cliCls=a.cliCls||"cli",this.codeCls=a.codeCls||"code",this.scriptsPath=a.scriptsPath||".",this.cliEl=document.getElementsByClassName(this.cliCls)[0],this.codeEl=document.getElementsByClassName(this.codeCls)[0]};TerminalWindow.prototype.loadScript=function(a,b){var c=this;a.endsWith(".json")||(a+=".json"),c.scriptName=c.scriptsPath+"/"+a,c._getJSON(c.scriptName,function(d){c._script=d.script,c.codeEl.innerHTML='<pre data-src="'+c.scriptsPath+"/"+a.slice(0,-2)+'"></pre>',b()})},TerminalWindow.prototype._getJSON=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.onload=function(){d.status>=200&&d.status<400?b(JSON.parse(d.responseText)):c(d)},d.onerror=c,d.send()},TerminalWindow.prototype.standby=function(a){this.cancel=!0,this.processing=!1,a&&(this.script=this._script=[])},TerminalWindow.prototype.processScript=function(a){function c(){var a=b.script.shift();a?(b[a[0]](a,c),b.cliEl.scrollTop=b.cliEl.scrollHeight):b.processing=!1}var b=this;b.script=(b._script||a||[]).slice(),b.processing=b.scriptName+(new Date).getTime(),b.cancel=!1,b.cliEl.innerHTML="",c()},TerminalWindow.prototype.type=function(a,b){function f(){var a=c.speed*(1-Math.random()/2);c.wait=a,setTimeout(function(){c.wait=0;var a=d.splice(0,1);if(c.cancel!==!0&&c.processing===e)return c.cliEl.innerHTML=c.cliEl.innerHTML.replace("█",""),c.cliEl.innerHTML=c.cliEl.innerHTML+a+"█",d.length<1?void(b&&b()):void(c.cancel===!1&&f())},a)}var c=this,d=a[1].split(""),e=c.processing;c.cancel===!1&&f()},TerminalWindow.prototype.prompt=function(a,b){var c=this;c.cliEl.innerHTML=c.cliEl.innerHTML.replace("█",""),c.cliEl.innerHTML=c.cliEl.innerHTML+(a[1]!==!1?c.delimiter:"")+" █",b&&b()},TerminalWindow.prototype.line=function(a,b){var c=this;c.cliEl.innerHTML=c.cliEl.innerHTML.replace("█",""),c.cliEl.innerHTML=c.cliEl.innerHTML+"<br>"+(a[1]!==!1?c.delimiter:"")+"█",b&&b()},TerminalWindow.prototype.sleep=function(a,b){var c=this;c.wait=a[1]||500,setTimeout(function(){c.wait=0,b&&b()},c.wait)},TerminalWindow.prototype.send=function(a,b){var c=this;c.cliEl.innerHTML=c.cliEl.innerHTML.replace("█",""),c.cliEl.innerHTML+=a[1],b&&b()},TerminalWindow.prototype.return=function(a,b){var c=this;c.cliEl.innerHTML=c.cliEl.innerHTML.slice(0,-(a[1]+1)),b&&b()};